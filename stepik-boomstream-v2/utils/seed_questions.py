"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏.
–°–æ–∑–¥–∞–µ—Ç 25-30 –≤–æ–ø—Ä–æ—Å–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏, –ø—Ä–∏–≤—è–∑–∫–∞–º–∏ –∫ –º–æ–¥—É–ª—è–º –∏ –≥–æ–ª–æ—Å–∞–º–∏.
"""

import sys
import random
from datetime import datetime, timedelta
from sqlalchemy import func

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É
sys.path.insert(0, '.')

from app.db import SessionLocal
from app.models import (
    Question, QuestionVote, QuestionStepikModule, 
    StepikModule, TelegramUser, QuestionAnswer
)


# –¢–µ—Å—Ç–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ç–µ–º–∞–º –∫—É—Ä—Å–∞
SAMPLE_QUESTIONS = [
    {
        "title": "–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —ç–Ω–µ—Ä–≥–∏—è–º–∏?",
        "body": "–ü—Ä–æ—à–ª–∞ –ø–µ—Ä–≤—ã–µ —É—Ä–æ–∫–∏ –∫—É—Ä—Å–∞, –Ω–æ –Ω–µ –¥–æ –∫–æ–Ω—Ü–∞ –ø–æ–Ω–∏–º–∞—é, –∫–∞–∫ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∑–Ω–∞–Ω–∏—è –æ–± –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç–Ω–µ—Ä–≥–∏—è—Ö –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ. –ï—Å—Ç—å –ª–∏ –∫–∞–∫–∏–µ-—Ç–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –∏–ª–∏ —Ç–µ—Ö–Ω–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç –ª—É—á—à–µ –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —ç—Ç–∏–º–∏ —ç–Ω–µ—Ä–≥–∏—è–º–∏ –≤ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π –∂–∏–∑–Ω–∏?",
        "modules": [1, 2]
    },
    {
        "title": "–ü—Å–∏—Ö–∏—á–µ—Å–∫–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –∏ –µ–≥–æ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –∑–¥–æ—Ä–æ–≤—å–µ",
        "body": "–ó–∞–º–µ—Ç–∏–ª–∞, —á—Ç–æ –ø–æ—Å–ª–µ —Å—Ç—Ä–µ—Å—Å–æ–≤—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π —É –º–µ–Ω—è –ø–æ—è–≤–ª—è—é—Ç—Å—è –≥–æ–ª–æ–≤–Ω—ã–µ –±–æ–ª–∏. –≠—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –ø—Å–∏—Ö–∏—á–µ—Å–∫–∏–º –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ–º, –æ –∫–æ—Ç–æ—Ä–æ–º –≥–æ–≤–æ—Ä–∏—Ç—Å—è –≤ —É—Ä–æ–∫–µ 8? –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–Ω–∏–º–∞—Ç—å —ç—Ç–æ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ?",
        "modules": [1]
    },
    {
        "title": "–ë–ª–æ–∫–∏ –Ω–∞ –≥–ª—É–±–æ–∫–∏—Ö —Å–ª–æ—è—Ö - –∫–∞–∫ –∏—Ö —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å?",
        "body": "–í —É—Ä–æ–∫–µ 15 —É–ø–æ–º–∏–Ω–∞—é—Ç—Å—è –±–ª–æ–∫–∏ –Ω–∞ –≥–ª—É–±–æ–∫–∏—Ö —Å–ª–æ—è—Ö. –ö–∞–∫–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ —Ç–æ, —á—Ç–æ —É —á–µ–ª–æ–≤–µ–∫–∞ –µ—Å—Ç—å –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–∏–µ –±–ª–æ–∫–∏? –ú–æ–∂–Ω–æ –ª–∏ –∏—Ö —Å–Ω—è—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∏–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞?",
        "modules": [2]
    },
    {
        "title": "–ü—Ä–∞–Ω–∞ –∏ –µ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –≤ –æ—Ä–≥–∞–Ω–∏–∑–º–µ",
        "body": "–ß–∏—Ç–∞–ª–∞ —É—Ä–æ–∫ 14 –ø—Ä–æ –ø—Ä–∞–Ω—É. –ö–∞–∫ –º–æ–∂–Ω–æ –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –µ–µ –¥–≤–∏–∂–µ–Ω–∏–µ? –ï—Å—Ç—å –ª–∏ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞ –ø—Ä–∞–Ω—ã?",
        "modules": [2]
    },
    {
        "title": "–í–∑–∞–∏–º–æ—Å–≤—è–∑—å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –∏ –ø—Å–∏—Ö–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ–ª–∞",
        "body": "–ò–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç –≤–æ–ø—Ä–æ—Å –∏–∑ —É—Ä–æ–∫–∞ 9: –µ—Å–ª–∏ —É —á–µ–ª–æ–≤–µ–∫–∞ —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∏–µ –±–æ–ª–∏ –≤ —Å–ø–∏–Ω–µ, —ç—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–≤—è–∑–∞–Ω–æ —Å –ø—Å–∏—Ö–∏—á–µ—Å–∫–∏–º —Ç–µ–ª–æ–º? –ò–ª–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —á–∏—Å—Ç–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏—á–∏–Ω—ã?",
        "modules": [1]
    },
    {
        "title": "–•—Ä–æ–Ω–∏—á–µ—Å–∫–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–µ—Ö–≤–∞—Ç–∫–∏ —ç–Ω–µ—Ä–≥–∏–∏",
        "body": "–ü–æ—Å—Ç–æ—è–Ω–Ω–æ —á—É–≤—Å—Ç–≤—É—é —É–ø–∞–¥–æ–∫ —Å–∏–ª, –æ—Å–æ–±–µ–Ω–Ω–æ –∫ –≤–µ—á–µ—Ä—É. –ü–æ –æ–ø–∏—Å–∞–Ω–∏—é –≤ —É—Ä–æ–∫–µ 4 –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ö—Ä–æ–Ω–∏—á–µ—Å–∫—É—é –Ω–µ—Ö–≤–∞—Ç–∫—É —ç–Ω–µ—Ä–≥–∏–∏. –ß—Ç–æ –¥–µ–ª–∞—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å? –° —á–µ–≥–æ –Ω–∞—á–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ?",
        "modules": [1]
    },
    {
        "title": "–í–∏–¥—ã –ø–µ—Ä–µ–Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è –∏ –∏—Ö –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è",
        "body": "–í —É—Ä–æ–∫–µ 5 –æ–ø–∏—Å–∞–Ω—ã —Ä–∞–∑–Ω—ã–µ –≤–∏–¥—ã –ø–µ—Ä–µ–Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è. –ú–æ–∂–µ—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ? –ö–∞–∫ –µ–≥–æ –æ—Ç–ª–∏—á–∏—Ç—å –æ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ?",
        "modules": [1]
    },
    {
        "title": "–ò–ª–ª—é–∑–∏–∏ –∏ –∏—Ö –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ",
        "body": "–û—á–µ–Ω—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è —Ç–µ–º–∞ –≤ —É—Ä–æ–∫–µ 6. –ö–∞–∫ –ø–æ–Ω—è—Ç—å, —á—Ç–æ —Ç—ã –Ω–∞—Ö–æ–¥–∏—à—å—Å—è –ø–æ–¥ –≤–ª–∏—è–Ω–∏–µ–º –∏–ª–ª—é–∑–∏–∏? –ï—Å—Ç—å –ª–∏ —Å–ø–æ—Å–æ–±—ã —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏?",
        "modules": [1]
    },
    {
        "title": "–ü—Å–∏—Ö–∏—á–µ—Å–∫–∏–µ –∫–∞–Ω–∞–ª—ã: –®—Ä–æ—Ç–æ—Å—ã –∏ –ù–∞–¥–∏",
        "body": "–í —É—Ä–æ–∫–µ 10 —É–ø–æ–º–∏–Ω–∞—é—Ç—Å—è –ø—Å–∏—Ö–∏—á–µ—Å–∫–∏–µ –∫–∞–Ω–∞–ª—ã. –≠—Ç–æ —Ç–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ –∏ —á–∞–∫—Ä—ã? –ò–ª–∏ —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã?",
        "modules": [1]
    },
    {
        "title": "–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª–µ–∑–Ω–µ–π —á–µ—Ä–µ–∑ –±–ª–æ–∫–∏",
        "body": "–£—Ä–æ–∫ 18 –æ—á–µ–Ω—å –≤–ø–µ—á–∞—Ç–ª–∏–ª. –ü–æ–ª—É—á–∞–µ—Ç—Å—è, —á—Ç–æ –º–Ω–æ–≥–∏–µ –±–æ–ª–µ–∑–Ω–∏ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Å–∏—Ö–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ–ª–∞? –ú–æ–∂–µ—Ç–µ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã?",
        "modules": [2]
    },
    {
        "title": "–ü—Ä–∞–≤–∏–ª–∞ –æ—á–∏—â–µ–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–º–∞",
        "body": "–ò–∑—É—á–∞—é —É—Ä–æ–∫ 19. –ö–∞–∫–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—á–∏—â–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è? –° —á–µ–≥–æ –ª—É—á—à–µ –Ω–∞—á–∏–Ω–∞—Ç—å - —Å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –∏–ª–∏ —Å –ø—Å–∏—Ö–∏—á–µ—Å–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è?",
        "modules": [2]
    },
    {
        "title": "–ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –ø—Ä–∞–≤–∏–ª –æ—á–∏—â–µ–Ω–∏—è",
        "body": "–ù–∞—á–∞–ª–∞ –ø—Ä–æ—Ü–µ—Å—Å –æ—á–∏—â–µ–Ω–∏—è, –Ω–æ –ø–æ—è–≤–∏–ª–∏—Å—å –Ω–µ–ø—Ä–∏—è—Ç–Ω—ã–µ —Å–∏–º–ø—Ç–æ–º—ã. –í —É—Ä–æ–∫–µ 20 –≥–æ–≤–æ—Ä–∏—Ç—Å—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –ø—Ä–∞–≤–∏–ª. –ß—Ç–æ –¥–µ–ª–∞—Ç—å –≤ —Ç–∞–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏?",
        "modules": [2]
    },
    {
        "title": "–ö–∞–∫ –≤–ª–∏—è–µ—Ç –Ω–µ—Ö–≤–∞—Ç–∫–∞ —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ —Ç–µ–ª–æ?",
        "body": "–£—Ä–æ–∫ 17: –µ—Å–ª–∏ –¥–æ–ª–≥–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Ö–≤–∞—Ç–∫—É —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞ –ø—Å–∏—Ö–∏—á–µ—Å–∫–æ–º —É—Ä–æ–≤–Ω–µ, –∫–∞–∫–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –ø—Ä–æ–±–ª–µ–º—ã —Å–æ –∑–¥–æ—Ä–æ–≤—å–µ–º –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å?",
        "modules": [2]
    },
    {
        "title": "–ü—Å–∏—Ö–∏—á–µ—Å–∫–∏–µ —Å–ª–æ–∏ –∏ –∏—Ö —Ñ—É–Ω–∫—Ü–∏–∏",
        "body": "–£—Ä–æ–∫–∏ 11 –∏ 12 –ø—Ä–æ –ø—Å–∏—Ö–∏—á–µ—Å–∫–∏–µ —Å–ª–æ–∏. –°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ —Å–ª–æ–µ–≤ –∏ –∫–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–∞–∂–¥—ã–π –∏–∑ –Ω–∏—Ö?",
        "modules": [2]
    },
    {
        "title": "–ë–ª–æ–∫–∏ –∏ –∏—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å–ª–æ—è—Ö",
        "body": "–í —É—Ä–æ–∫–µ 16 —É–ø–æ–º–∏–Ω–∞—é—Ç—Å—è –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –±–ª–æ–∫–æ–≤. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –±–ª–æ–∫ –Ω–∞ –æ–¥–Ω–æ–º —Å–ª–æ–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ —Å–ª–æ–∏? –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?",
        "modules": [2]
    },
    {
        "title": "–û –∫—Ä–∞—Å–æ—Ç–µ, –≤–ª–∏—è–Ω–∏–∏ –∏ –±–µ—Å–ø–ª–æ–¥–∏–∏",
        "body": "–£—Ä–æ–∫ 7 –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ç–µ–º—ã. –ú–æ–∂–µ—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ–±—ä—è—Å–Ω–∏—Ç—å —Å–≤—è–∑—å –º–µ–∂–¥—É –ø—Å–∏—Ö–∏—á–µ—Å–∫–∏–º–∏ —ç–Ω–µ—Ä–≥–∏—è–º–∏ –∏ –≤–Ω–µ—à–Ω–µ–π –∫—Ä–∞—Å–æ—Ç–æ–π?",
        "modules": [1]
    },
    {
        "title": "–û—Å–Ω–æ–≤–Ω—ã–µ –∂–µ–ª–∞–Ω–∏—è —á–µ–ª–æ–≤–µ–∫–∞",
        "body": "–ü–µ—Ä–≤—ã–π —É—Ä–æ–∫ –ø—Ä–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –∂–µ–ª–∞–Ω–∏—è. –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–æ–µ –∂–µ–ª–∞–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è –≤–µ–¥—É—â–∏–º –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞?",
        "modules": [1]
    },
    {
        "title": "–ú–µ–¥–∏—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —ç–Ω–µ—Ä–≥–∏–µ–π",
        "body": "–ö–∞–∫–∏–µ –º–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —ç–Ω–µ—Ä–≥–∏—è–º–∏? –ï—Å—Ç—å –ª–∏ –≥–æ—Ç–æ–≤—ã–µ –º–µ–¥–∏—Ç–∞—Ü–∏–∏ –≤ –∫—É—Ä—Å–µ?",
        "modules": [1, 2]
    },
    {
        "title": "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –±–ª–æ–∫–æ–≤ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ",
        "body": "–ú–æ–∂–Ω–æ –ª–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ –±–ª–æ–∫–∏ –∏–ª–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω—É–∂–µ–Ω —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç? –ö–∞–∫–∏–µ –º–µ—Ç–æ–¥—ã —Å–∞–º–æ–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –≤—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç–µ?",
        "modules": [2]
    },
    {
        "title": "–ü–∏—Ç–∞–Ω–∏–µ –∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞",
        "body": "–í–ª–∏—è–µ—Ç –ª–∏ –ø–∏—Ç–∞–Ω–∏–µ –Ω–∞ –ø—Å–∏—Ö–∏—á–µ—Å–∫–∏–µ —ç–Ω–µ—Ä–≥–∏–∏? –ï—Å—Ç—å –ª–∏ –ø—Ä–æ–¥—É–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —É—Å–∏–ª–∏–≤–∞—é—Ç –∏–ª–∏ –æ—Å–ª–∞–±–ª—è—é—Ç —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫—É?",
        "modules": [1, 2]
    },
    {
        "title": "–°–æ–Ω –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏",
        "body": "–ö–∞–∫–∞—è —Å–≤—è–∑—å –º–µ–∂–¥—É –∫–∞—á–µ—Å—Ç–≤–æ–º —Å–Ω–∞ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø—Å–∏—Ö–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ–ª–∞? –ü–æ—á–µ–º—É –∏–Ω–æ–≥–¥–∞ –¥–∞–∂–µ –ø–æ—Å–ª–µ –¥–æ–ª–≥–æ–≥–æ —Å–Ω–∞ –Ω–µ—Ç –æ—â—É—â–µ–Ω–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è?",
        "modules": [1]
    },
    {
        "title": "–†–∞–±–æ—Ç–∞ —Å —Ç—Ä–∞–≤–º–∞–º–∏ –ø—Ä–æ—à–ª–æ–≥–æ",
        "body": "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∞–≤–º—ã –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ - —ç—Ç–æ —Ç–æ–∂–µ –±–ª–æ–∫–∏? –ö–∞–∫ —Å –Ω–∏–º–∏ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∫—É—Ä—Å–∞?",
        "modules": [2]
    },
    {
        "title": "–î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è —ç–Ω–µ—Ä–≥–∏–∏",
        "body": "–ï—Å—Ç—å –ª–∏ –≤ –∫—É—Ä—Å–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º? –ö–∞–∫–æ–µ –¥—ã—Ö–∞–Ω–∏–µ –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å —ç–Ω–µ—Ä–≥–∏—é?",
        "modules": [1]
    },
    {
        "title": "–í–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞",
        "body": "–ú–µ–Ω—è–µ—Ç—Å—è –ª–∏ —Ä–∞–±–æ—Ç–∞ —Å —ç–Ω–µ—Ä–≥–∏—è–º–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–æ–∑—Ä–∞—Å—Ç–∞? –ï—Å—Ç—å –ª–∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è –ª—é–¥–µ–π –ø–æ—Å–ª–µ 50 –ª–µ—Ç?",
        "modules": [1]
    },
    {
        "title": "–≠–Ω–µ—Ä–≥–∏—è –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å –ª—é–¥—å–º–∏",
        "body": "–ö–∞–∫ –ø—Å–∏—Ö–∏—á–µ—Å–∫–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ –≤–ª–∏—è—é—Ç –Ω–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å –±–ª–∏–∑–∫–∏–º–∏ –ª—é–¥—å–º–∏? –ú–æ–∂–Ω–æ –ª–∏ \"–∑–∞—Ä–∞–∂–∞—Ç—å—Å—è\" —á—É–∂–∏–º–∏ –±–ª–æ–∫–∞–º–∏?",
        "modules": [1, 2]
    },
    {
        "title": "–ß–∞—Å—Ç–æ—Ç–∞ –∑–∞–Ω—è—Ç–∏–π –ø—Ä–∞–∫—Ç–∏–∫–∞–º–∏",
        "body": "–ö–∞–∫ —á–∞—Å—Ç–æ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏–∑ –∫—É—Ä—Å–∞? –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –∏–ª–∏ –º–æ–∂–Ω–æ —Ä–µ–∂–µ? –ß—Ç–æ –±—É–¥–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º —Ä–µ–∂–∏–º–æ–º?",
        "modules": [1, 2]
    },
    {
        "title": "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫—É—Ä—Å–∞ - –∫–æ–≥–¥–∞ –∂–¥–∞—Ç—å?",
        "body": "–ß–µ—Ä–µ–∑ –∫–∞–∫–æ–µ –≤—Ä–µ–º—è –º–æ–∂–Ω–æ –æ–∂–∏–¥–∞—Ç—å –ø–µ—Ä–≤—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞–Ω–∏–π –∫—É—Ä—Å–∞? –£ –∫–æ–≥–æ-—Ç–æ –µ—Å—Ç—å —É–∂–µ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–π –æ–ø—ã—Ç?",
        "modules": [1, 2]
    },
    {
        "title": "–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –¥—Ä—É–≥–∏–º–∏ –ø—Ä–∞–∫—Ç–∏–∫–∞–º–∏",
        "body": "–ú–æ–∂–Ω–æ –ª–∏ —Å–æ–≤–º–µ—â–∞—Ç—å —Ä–∞–±–æ—Ç—É –ø–æ —ç—Ç–æ–º—É –∫—É—Ä—Å—É —Å –π–æ–≥–æ–π –∏–ª–∏ –¥—Ä—É–≥–∏–º–∏ –¥—É—Ö–æ–≤–Ω—ã–º–∏ –ø—Ä–∞–∫—Ç–∏–∫–∞–º–∏? –ò–ª–∏ –ª—É—á—à–µ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ —á–µ–º-—Ç–æ –æ–¥–Ω–æ–º?",
        "modules": [1, 2]
    },
]


def create_sample_questions():
    """–°–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö."""
    
    db = SessionLocal()
    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –º–æ–¥—É–ª–µ–π
        modules = db.query(StepikModule).all()
        if not modules:
            print("‚ùå –í –±–∞–∑–µ –Ω–µ—Ç –º–æ–¥—É–ª–µ–π Stepik. –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ –º–æ–¥—É–ª–∏.")
            return
        
        print(f"‚úì –ù–∞–π–¥–µ–Ω–æ –º–æ–¥—É–ª–µ–π: {len(modules)}")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        telegram_users = db.query(TelegramUser).all()
        if not telegram_users:
            print("‚ö† –í –±–∞–∑–µ –Ω–µ—Ç Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –°–æ–∑–¥–∞—é —Ç–µ—Å—Ç–æ–≤—ã—Ö...")
            # –°–æ–∑–¥–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            for i in range(1, 21):
                user = TelegramUser(
                    id=1000000 + i,
                    first_name=f"User{i}",
                    username=f"user{i}"
                )
                db.add(user)
            db.commit()
            telegram_users = db.query(TelegramUser).all()
        
        print(f"‚úì Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {len(telegram_users)}")
        
        # –°–æ–∑–¥–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã
        questions_created = 0
        
        for i, q_data in enumerate(SAMPLE_QUESTIONS):
            # –°–æ–∑–¥–∞–µ–º –≤–æ–ø—Ä–æ—Å
            question = Question(
                title=q_data["title"],
                body=q_data["body"],
                status='VOTING',  # –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≤ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏
                created_at=datetime.utcnow() - timedelta(days=random.randint(0, 30))
            )
            
            # –í–∞—Ä—å–∏—Ä—É–µ–º —Å—Ç–∞—Ç—É—Å—ã –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
            if i < 20:
                question.status = 'VOTING'
            elif i < 23:
                question.status = 'POSTED'
                question.posted_at = datetime.utcnow() - timedelta(days=random.randint(1, 5))
            elif i < 25:
                question.status = 'CLOSED'
                question.posted_at = datetime.utcnow() - timedelta(days=random.randint(8, 10))
                question.closed_at = datetime.utcnow() - timedelta(days=random.randint(1, 3))
            else:
                question.status = 'ARCHIVED'
                question.posted_at = datetime.utcnow() - timedelta(days=random.randint(15, 20))
                question.closed_at = datetime.utcnow() - timedelta(days=random.randint(8, 12))
                question.archived_at = datetime.utcnow() - timedelta(days=random.randint(1, 5))
            
            db.add(question)
            db.flush()  # –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å question.id
            
            # –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫ –º–æ–¥—É–ª—è–º
            module_indices = q_data["modules"]
            for mod_idx in module_indices:
                if mod_idx <= len(modules):
                    qsm = QuestionStepikModule(
                        question_id=question.id,
                        module_id=modules[mod_idx - 1].id,
                        is_primary=(mod_idx == module_indices[0])
                    )
                    db.add(qsm)
            
            # –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –≥–æ–ª–æ—Å–∞ (–æ—Ç 3 –¥–æ 25 –ª–∞–π–∫–æ–≤)
            num_votes = random.randint(3, 25)
            voters = random.sample(telegram_users, min(num_votes, len(telegram_users)))
            
            for voter in voters:
                vote = QuestionVote(
                    question_id=question.id,
                    telegram_user_id=voter.id
                )
                db.add(vote)
            
            # –î–ª—è –∞—Ä—Ö–∏–≤–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç—ã
            if question.status == 'ARCHIVED':
                answer = QuestionAnswer(
                    question_id=question.id,
                    summary="–í–æ–ø—Ä–æ—Å –±—ã–ª –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞–∑–æ–±—Ä–∞–Ω –≤ –æ–±—Å—É–∂–¥–µ–Ω–∏–∏. –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã: —Ä–∞–±–æ—Ç–∞ —Å —ç–Ω–µ—Ä–≥–∏—è–º–∏ —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ –≤–Ω–∏–º–∞–Ω–∏—è –∫ —Å–≤–æ–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é.",
                    answer=f"""## –ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å

–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –∑–∞ –æ—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –í —Ö–æ–¥–µ –Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ –æ–±—Å—É–∂–¥–µ–Ω–∏—è –º—ã –ø—Ä–∏—à–ª–∏ –∫ —Å–ª–µ–¥—É—é—â–∏–º –≤—ã–≤–æ–¥–∞–º:

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **{q_data['title']}** - —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–∞–∂–Ω–∞—è —Ç–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–ª–Ω—É–µ—Ç –º–Ω–æ–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫—É—Ä—Å–∞.

2. –ö–∞–∫ –ø–æ–∫–∞–∑–∞–ª–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞ –Ω–∞—à–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤, –ª—É—á—à–∏–π –ø–æ–¥—Ö–æ–¥ –≤–∫–ª—é—á–∞–µ—Ç:
   - –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è (–Ω–µ –º–µ–Ω–µ–µ 3 —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)
   - –í–µ–¥–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π
   - –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É–≥–ª—É–±–ª–µ–Ω–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

3. –í–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å –æ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–º –ø–æ–¥—Ö–æ–¥–µ - —Ç–æ —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –æ–¥–Ω–æ–≥–æ, –º–æ–∂–µ—Ç –Ω–µ –ø–æ–¥–æ–π—Ç–∏ –¥—Ä—É–≥–æ–º—É.

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- –ù–∞—á–∏–Ω–∞–π—Ç–µ —Å –ø—Ä–æ—Å—Ç—ã—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —É—Ä–æ–∫–æ–≤ –∫—É—Ä—Å–∞
- –û–±—Ä–∞—â–∞–π—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–∫—Ü–∏–∏ —Å–≤–æ–µ–≥–æ —Ç–µ–ª–∞
- –ù–µ —Ñ–æ—Ä—Å–∏—Ä—É–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å, –¥–∞–π—Ç–µ –≤—Ä–µ–º—è –Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –∑–Ω–∞–Ω–∏–π

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

–°–º. —É—Ä–æ–∫–∏: {', '.join([f'–†–∞–∑–¥–µ–ª {m}' for m in module_indices])}

–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –æ–±—Å—É–∂–¥–µ–Ω–∏—è–º –≤ –≥—Ä—É–ø–ø–µ –¥–ª—è –æ–±–º–µ–Ω–∞ –æ–ø—ã—Ç–æ–º!
""",
                    sources={"lessons": module_indices, "external_links": []}
                )
                db.add(answer)
            
            questions_created += 1
        
        db.commit()
        print(f"\n‚úÖ –°–æ–∑–¥–∞–Ω–æ –≤–æ–ø—Ä–æ—Å–æ–≤: {questions_created}")
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        stats = db.query(Question.status, func.count(Question.id)).group_by(Question.status).all()
        print("\n–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º:")
        for status, count in stats:
            print(f"  {status}: {count}")
        
        total_votes = db.query(func.count(QuestionVote.question_id)).scalar()
        print(f"\n–í—Å–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤: {total_votes}")
        
        print("\n‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã!")
        print("\nüåê –û—Ç–∫—Ä–æ–π—Ç–µ http://127.0.0.1:5000/questions –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞")
        
    except Exception as e:
        db.rollback()
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        raise
    finally:
        db.close()


if __name__ == "__main__":
    print("=" * 60)
    print("–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏")
    print("=" * 60)
    print()
    
    create_sample_questions()
