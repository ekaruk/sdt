# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ ngrok

## –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ ‚úÖ

1. **Bot.py –æ–±–Ω–æ–≤–ª–µ–Ω**: URL Mini App –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ –≤–∞—à ngrok –¥–æ–º–µ–Ω
   ```python
   QUESTIONS_MINIAPP_URL = "https://vapid-agnus-unconversational.ngrok-free.dev/questions/miniapp"
   ```

2. **Flask —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω** –Ω–∞ –ø–æ—Ä—Ç—É 5000

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ ngrok

–ï—Å–ª–∏ –µ—â–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω:

```powershell
ngrok http 5000
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL —Å–æ–≤–ø–∞–¥–∞–µ—Ç:
- –í ngrok: `https://vapid-agnus-unconversational.ngrok-free.dev`
- –í bot.py: —Ç–æ—Ç –∂–µ URL

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Telegram –±–æ—Ç–∞

```powershell
python bot.py
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Telegram

1. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/questions`
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "üìã –í–æ–ø—Ä–æ—Å—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤"
4. Mini App –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤ Telegram

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å:**
- ‚úÖ –°–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- ‚úÖ –§–∏–ª—å—Ç—Ä—ã –ø–æ —Ç–µ–º–∞–º/—Å—Ç–∞—Ç—É—Å–∞–º/–ø–µ—Ä–∏–æ–¥–∞–º
- ‚úÖ –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ (–∏–∫–æ–Ω–∫–∞ —Å–µ—Ä–¥–µ—á–∫–∞)
- ‚úÖ –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ç–µ–º—É Telegram
- ‚úÖ Haptic feedback –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏—è—Ö

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- Telegram WebApp SDK –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è (`window.Telegram.WebApp`)
- initData –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –Ω–∞ /login

### 5. –û—Ç–ª–∞–¥–∫–∞ (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ ngrok

```powershell
# –û—Ç–∫—Ä–æ–π—Ç–µ ngrok Web Interface
# http://127.0.0.1:4040
```

–°–º–æ—Ç—Ä–∏—Ç–µ –≤—Å–µ HTTP –∑–∞–ø—Ä–æ—Å—ã –æ—Ç Telegram –∫ –≤–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É.

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ Flask –ª–æ–≥–æ–≤

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —Å `python web_app.py` —Å–º–æ—Ç—Ä–∏—Ç–µ:
- `GET /questions/miniapp` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- `GET /api/questions` - API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- `POST /questions/{id}/vote` - –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

#### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**Mini App –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ ngrok —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ URL –¥–æ—Å—Ç—É–ø–µ–Ω
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ bot.py –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π HTTPS URL
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è bot.py

**–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login):**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DevTools ‚Üí Network ‚Üí Headers
- –ó–∞–≥–æ–ª–æ–≤–æ–∫ `X-Telegram-Init-Data` –¥–æ–ª–∂–µ–Ω –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å
- –í Flask –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞: `[VOTE] Extracted telegram_user_id from initData: {id}`

**–§–∏–ª—å—Ç—Ä—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç:**
- –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Console (–¥–æ–ª–≥–∏–π —Ç–∞–ø –≤ Mini App ‚Üí Inspect Element)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ JavaScript –æ—à–∏–±–∫–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network –∑–∞–ø—Ä–æ—Å—ã –∫ `/api/questions?topic=...`

**–î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞ (PostgreSQL –Ω–∞ Render)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ .env –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π DATABASE_URL
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ seed_questions.py –±—ã–ª –≤—ã–ø–æ–ª–Ω–µ–Ω

### 6. –ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ö–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∏—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok (Ctrl+C)
2. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Flask (Ctrl+C)
3. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–æ—Ç–∞ (Ctrl+C)

–î–ª—è production –≤–µ—Ä–Ω–∏—Ç–µ URL –≤ bot.py:
```python
QUESTIONS_MINIAPP_URL = "https://stepik-boomstream-v2.onrender.com/questions/miniapp"
```

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```powershell
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞
curl https://vapid-agnus-unconversational.ngrok-free.dev/questions/miniapp

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API
curl https://vapid-agnus-unconversational.ngrok-free.dev/api/questions

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–¥—É–ª–∏
curl https://vapid-agnus-unconversational.ngrok-free.dev/api/modules
```

## CORS (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ Telegram –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç CORS –æ—à–∏–±–∫–∏, –¥–æ–±–∞–≤—å—Ç–µ –≤ app/__init__.py:

```python
from flask_cors import CORS

def create_app():
    app = Flask(__name__)
    CORS(app, resources={r"/api/*": {"origins": "https://web.telegram.org"}})
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
```

–ò —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
```powershell
pip install flask-cors
```

–ù–æ –æ–±—ã—á–Ω–æ —ç—Ç–æ **–ù–ï –Ω—É–∂–Ω–æ**, —Ç.–∫. Mini App –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ iframe —Å —Ç–µ–º –∂–µ origin.
